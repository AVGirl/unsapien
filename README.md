# unsapien

unsapien is a Python script developed in order to extract scripts, files and configuration from executables created by [SAPIEN](https://www.sapien.com) Script Packager available in products such as:

- [PowerShell Studio](https://www.sapien.com/software/powershell_studio)
- [PrimalScript](https://www.sapien.com/software/primalscript)

Script has been initially created in order to quickly extract and triage PowerShell scripts from a large number of (potentially malicious) executables found on [VirusTotal](https://www.virustotal.com).


## Requirements

This script needs Python 2.7.x and has been tested on macOS High Sierra and Ubuntu 17.10. Following additional Python modules are needed:

- hexdump
- pefile
- construct (>=2.9)
- pbkdf2
- pycrypto


## Usage

```
usage: unsapien.py [-h] [-v] [-d directory] file

Extracts embedded scripts, files and configuration from binaries generated by
SAPIEN Script Packager (available e.g. in PowerShell Studio or PrimalScript)

positional arguments:
  file                  Input file

optional arguments:
  -h, --help            show this help message and exit
  -v, --verbose         Enable verbose output
  -d directory, --dump directory
                        Dump files to specified directory
```


## Limitations


Script is based solely on data obtained from analysis performed on limited number of executables found on [VirusTotal](https://www.virustotal.com) and may not work with all versions of SAPIEN Script Packager.


## References

[ExeToPosh](https://www.remkoweijnen.nl/blog/2017/03/13/convert-executable-powershell/) is a tool written by [@RemkoWeijnen](https://www.twitter.com/RemkoWeijnen) and capable of extracting scripts packaged by some versions of SAPIEN PowerShell Studio.

[Blog post](http://www.exploit-monday.com/2012/05/extracting-hard-coded-credentials-using.html) by [@mattifestation](https://twitter.com/mattifestation) showing how to dynamically extract script content from binaries generated by SAPIEN PrimalScript.

